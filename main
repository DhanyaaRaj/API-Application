var express = require('express');
var jwt = require('jsonwebtoken');
var app = express();
var fileapp = require('./app')

app.get('/api/signin', (req, res) => {
    var users =[ {
        username: "johndoe",
        password: "john23"}
 ,{
        username:"ram",
        password:"ram123"

    }]
    jwt.sign({users},'SuperSecRetKey', { expiresIn: 60 * 60 }, (err, token) => {
        res.send({token});
           
    });
});

app.listen(4000,function(){
console.log('tokens');
})

function verifyToken(req, res, next){
    
    //Request header with authorization key
    const bearerHeader = req.headers['authorization'];
    
    //Check if there is  a header
    if(typeof bearerHeader !== 'undefined'){
        const bearer = bearerHeader.split(' ');
        
        //Get Token arrray by spliting
        const bearerToken = bearer[1];
        req.token = bearerToken;
        //call next middleware
        next();
    }else{
        res.sendStatus(403);
    }
}


module.exports= verifyToken;
